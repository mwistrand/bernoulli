<div class="task-form-container">
  <div class="form-header">
    <button
      class="back-button"
      (click)="goBackToProject()"
      [attr.aria-label]="'tasks.backToProject' | translate"
    >
      <lucide-icon
        [attr.aria-hidden]="true"
        [img]="ArrowLeftIcon"
        size="20"
        class="icon"
      ></lucide-icon>
      {{ 'tasks.backToProject' | translate }}
    </button>
    <h1>{{ pageTitle | translate }}</h1>
  </div>

  @if (isLoading() && isEditMode) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>{{ 'tasks.dialog.loading' | translate }}</p>
    </div>
  } @else {
    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      @if (errorMessage()) {
        <div class="error-banner" role="alert">
          {{ errorMessage() }}
        </div>
      }

      <div class="form-group">
        <label for="task-title" class="required">{{ 'tasks.dialog.title' | translate }}</label>
        <input
          type="text"
          id="task-title"
          formControlName="title"
          [placeholder]="'tasks.dialog.titlePlaceholder' | translate"
          maxlength="300"
          [class.invalid]="taskForm.get('title')?.invalid && taskForm.get('title')?.touched"
          aria-required="true"
        />
        @if (taskForm.get('title')?.invalid && taskForm.get('title')?.touched) {
          <span class="field-error" role="alert">
            @if (taskForm.get('title')?.errors?.['required']) {
              {{ 'tasks.dialog.errors.titleRequired' | translate }}
            }
            @if (taskForm.get('title')?.errors?.['maxlength']) {
              {{ 'tasks.dialog.errors.titleMaxLength' | translate }}
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="task-summary">{{ 'tasks.dialog.summary' | translate }}</label>
        <input
          type="text"
          id="task-summary"
          formControlName="summary"
          [placeholder]="'tasks.dialog.summaryPlaceholder' | translate"
          maxlength="500"
          [class.invalid]="taskForm.get('summary')?.invalid && taskForm.get('summary')?.touched"
        />
        @if (taskForm.get('summary')?.invalid && taskForm.get('summary')?.touched) {
          <span class="field-error" role="alert">
            @if (taskForm.get('summary')?.errors?.['maxlength']) {
              {{ 'tasks.dialog.errors.summaryMaxLength' | translate }}
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="task-description" class="required">{{
          'tasks.dialog.description' | translate
        }}</label>
        <textarea
          id="task-description"
          formControlName="description"
          [placeholder]="'tasks.dialog.descriptionPlaceholder' | translate"
          maxlength="5000"
          rows="10"
          [class.invalid]="
            taskForm.get('description')?.invalid && taskForm.get('description')?.touched
          "
          aria-required="true"
        ></textarea>
        @if (taskForm.get('description')?.invalid && taskForm.get('description')?.touched) {
          <span class="field-error" role="alert">
            @if (taskForm.get('description')?.errors?.['required']) {
              {{ 'tasks.dialog.errors.descriptionRequired' | translate }}
            }
            @if (taskForm.get('description')?.errors?.['maxlength']) {
              {{ 'tasks.dialog.errors.descriptionMaxLength' | translate }}
            }
          </span>
        }
      </div>

      <div class="form-actions">
        <button type="button" class="button-secondary" (click)="goBackToProject()">
          {{ 'tasks.dialog.cancel' | translate }}
        </button>
        <button type="submit" class="button-primary" [disabled]="taskForm.invalid || isLoading()">
          {{ submitButtonText | translate }}
        </button>
      </div>
    </form>
  }
</div>
