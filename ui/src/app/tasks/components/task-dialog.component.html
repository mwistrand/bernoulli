@if (isOpen()) {
  <div
    class="dialog-backdrop"
    (click)="onBackdropClick($event)"
    (keydown)="onKeyDown($event)"
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialog-title"
  >
    <div class="dialog-content" cdkTrapFocus [cdkTrapFocusAutoCapture]="true">
      <div class="dialog-header">
        <h2 id="dialog-title">{{ dialogTitle | translate }}</h2>
        <button
          type="button"
          class="close-button"
          (click)="closeDialog()"
          [attr.aria-label]="'tasks.dialog.closeDialog' | translate"
        >
          <lucide-icon [attr.aria-hidden]="true" [img]="XIcon" size="24"></lucide-icon>
          <span class="aria-hidden">{{ 'tasks.dialog.closeDialog' | translate }}</span>
        </button>
      </div>

      <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
        @if (errorMessage()) {
          <div class="error-banner" role="alert">
            {{ errorMessage() }}
          </div>
        }

        <div class="form-group">
          <label for="task-title" class="required">{{ 'tasks.dialog.title' | translate }}</label>
          <input
            type="text"
            id="task-title"
            formControlName="title"
            [placeholder]="'tasks.dialog.titlePlaceholder' | translate"
            maxlength="300"
            [class.invalid]="taskForm.get('title')?.invalid && taskForm.get('title')?.touched"
            aria-required="true"
            cdkFocusInitial
          />
          @if (taskForm.get('title')?.invalid && taskForm.get('title')?.touched) {
            <span class="field-error" role="alert">
              @if (taskForm.get('title')?.errors?.['required']) {
                {{ 'tasks.dialog.errors.titleRequired' | translate }}
              }
              @if (taskForm.get('title')?.errors?.['maxlength']) {
                {{ 'tasks.dialog.errors.titleMaxLength' | translate }}
              }
            </span>
          }
        </div>

        <div class="form-group">
          <label for="task-summary">{{ 'tasks.dialog.summary' | translate }}</label>
          <input
            type="text"
            id="task-summary"
            formControlName="summary"
            [placeholder]="'tasks.dialog.summaryPlaceholder' | translate"
            maxlength="500"
            [class.invalid]="taskForm.get('summary')?.invalid && taskForm.get('summary')?.touched"
          />
          @if (taskForm.get('summary')?.invalid && taskForm.get('summary')?.touched) {
            <span class="field-error" role="alert">
              @if (taskForm.get('summary')?.errors?.['maxlength']) {
                {{ 'tasks.dialog.errors.summaryMaxLength' | translate }}
              }
            </span>
          }
        </div>

        <div class="form-group">
          <label for="task-description" class="required">{{
            'tasks.dialog.description' | translate
          }}</label>
          <textarea
            id="task-description"
            formControlName="description"
            [placeholder]="'tasks.dialog.descriptionPlaceholder' | translate"
            maxlength="5000"
            rows="6"
            [class.invalid]="
              taskForm.get('description')?.invalid && taskForm.get('description')?.touched
            "
            aria-required="true"
          ></textarea>
          @if (taskForm.get('description')?.invalid && taskForm.get('description')?.touched) {
            <span class="field-error" role="alert">
              @if (taskForm.get('description')?.errors?.['required']) {
                {{ 'tasks.dialog.errors.descriptionRequired' | translate }}
              }
              @if (taskForm.get('description')?.errors?.['maxlength']) {
                {{ 'tasks.dialog.errors.descriptionMaxLength' | translate }}
              }
            </span>
          }
        </div>

        <div class="dialog-actions">
          <button type="button" class="button-secondary" (click)="closeDialog()">
            {{ 'tasks.dialog.cancel' | translate }}
          </button>
          <button type="submit" class="button-primary" [disabled]="taskForm.invalid || isLoading()">
            {{ submitButtonText | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
